<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>src03_leptos ‚Äî E-Commerce</title>
    <link id="theme-stylesheet" rel="stylesheet" href="css/style-light.css">
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
        }
        
        #theme-toggle {
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 9999;
            background: var(--button-bg, #f0f0f0);
            color: var(--text-primary, #333);
            border: 2px solid var(--border-color, #ccc);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            cursor: pointer;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
        }
        
        #theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.18);
        }
        
        #theme-toggle:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
        <button id="theme-toggle" title="Cambia tema (Light/Dark/Modern)">‚òÄÔ∏è</button>
    <div id="app"></div>
        <!-- Minimal CSS variable fallbacks so page is styled even if external theme CSS fails to load -->
        <style id="theme-fallback-root">
            :root{
                --bg-primary: #ffffff;
                --text-primary: #2c3e50;
                --button-bg: #ecf0f1;
                --border-color: #bdc3c7;
            }
            html,body{background-color:var(--bg-primary);color:var(--text-primary)}
        </style>
    <script>
        const themes = ['light', 'dark', 'modern'];
        
        function switchTheme(themeName) {
            localStorage.setItem('preferred-theme', themeName);
            const link = document.getElementById('theme-stylesheet');
            // Set an onerror handler to gracefully fallback if the CSS file is missing
            link.onerror = function() {
                // If the requested theme file fails to load, fallback to light theme
                console.warn('Theme stylesheet failed to load. Falling back to light theme.');
                link.onerror = null; // avoid loops
                link.href = 'css/style-light.css';
                localStorage.setItem('preferred-theme', 'light');
                document.documentElement.setAttribute('data-theme', 'light');
                updateThemeToggleIcon();
            };
            link.href = `css/style-${themeName}.css`;
            // Apply essential CSS variable overrides immediately so the UI updates
            applyEssentialThemeVars(themeName);
            updateThemeToggleIcon();
            document.documentElement.setAttribute('data-theme', themeName);
        }

        // Essential variable sets for immediate visual feedback (fallback when external CSS isn't loaded)
        const themeVars = {
            light: {
                '--bg-primary': '#ffffff',
                '--text-primary': '#2c3e50',
                '--button-bg': '#ecf0f1',
                '--border-color': '#bdc3c7'
            },
            dark: {
                '--bg-primary': '#121212',
                '--text-primary': '#e0e0e0',
                '--button-bg': '#2a2a2a',
                '--border-color': '#3f3f3f'
            },
            modern: {
                '--bg-primary': '#f8f9ff',
                '--text-primary': '#2d3436',
                '--button-bg': '#eef2ff',
                '--border-color': '#dde4ff'
            }
        };

        function applyEssentialThemeVars(themeName){
            const vars = themeVars[themeName] || themeVars.light;
            Object.entries(vars).forEach(([k,v]) => {
                document.documentElement.style.setProperty(k, v);
            });
            // also update fallback style block for immediate effect on first paint
            const fallback = document.getElementById('theme-fallback-root');
            if(fallback) fallback.textContent = `:root{${Object.entries(vars).map(([k,v])=>`${k}:${v};`).join('')}}`;
        }
        
        function updateThemeToggleIcon() {
            const toggle = document.getElementById('theme-toggle');
            const theme = localStorage.getItem('preferred-theme') || 'light';
            const icons = {
                light: '‚òÄÔ∏è',
                dark: 'üåô',
                modern: '‚ú®'
            };
            toggle.textContent = icons[theme];
        }
        
        function nextTheme() {
            const currentTheme = localStorage.getItem('preferred-theme') || 'light';
            const nextIndex = (themes.indexOf(currentTheme) + 1) % themes.length;
            switchTheme(themes[nextIndex]);
        }
        
        // Initialize theme on page load
        window.addEventListener('DOMContentLoaded', function() {
            const saved = localStorage.getItem('preferred-theme') || 'light';
            switchTheme(saved);
            
            const toggle = document.getElementById('theme-toggle');
            toggle.addEventListener('click', nextTheme);
        });
        
        // Expose globally for console testing
        window.switchTheme = switchTheme;
        window.nextTheme = nextTheme;
    </script>
</body>
</html>
